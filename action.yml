name: "Deploy to K8S"

description: "Deploys the application to the SAU kubernetes cluster."

inputs:
  node-version:
    description: "The Node.js version to use"
    required: true

runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v5

    - name: Install kubectl
      shell: bash
      run: |
        curl -L -o kubectl https://storage.googleapis.com/kubernetes-release/release/$(curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt)/bin/linux/amd64/kubectl
        chmod +x kubectl
        sudo mv kubectl /usr/local/bin/kubectl

    - name: Write kubeconfig
      shell: bash
      run: |
        printf '%s' "${{ secrets.KUBECONFIG }}" > "$KUBECONFIG"
        chmod 600 "$KUBECONFIG"

    - name: Deploy manifests to ase-15
      shell: bash
      run: |
        kubectl -n ase-15 apply -f k8s/
        kubectl -n ase-15 rollout status deploy/app
