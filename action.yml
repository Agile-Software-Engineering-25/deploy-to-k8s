name: "Deploy to K8S"

description: "Deploys the application to the SAU kubernetes cluster."

inputs:
  kubeconfig:
    description: "Kubeconfig contents. Pass your repository or environment secret."
    required: true

runs:
  using: "composite"
  steps:
    - uses: actions/checkout@v5

    - name: Install kubectl
      shell: bash
      run: |
        curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/amd64/kubectl"
        chmod +x kubectl
        sudo mv kubectl /usr/local/bin/kubectl

    - name: Write kubeconfig
      shell: bash
      env:
        KUBECONFIG: ${{ github.workspace }}/kubeconfig
      run: |
        printf '%s' "${{ inputs.kubeconfig }}" > "$KUBECONFIG"

    - name: Deploy manifests to ase-15
      shell: bash
      env:
        KUBECONFIG: ${{ github.workspace }}/kubeconfig
      run: |
        kubectl -n ase-15 apply -f k8s/
        kubectl -n ase-15 rollout status deploy/app
